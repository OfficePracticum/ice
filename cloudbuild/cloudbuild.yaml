steps:
- name: 'maven:3-jdk-8-slim'
  entrypoint: 'mvn'
  args: ['-Dmaven.compiler.source=1.7', '-Dmaven.compiler.target=1.7', 'install']
  dir: 'opencds/opencds-knowledge-repository-data'
  volumes:
  - name: 'm2'
    path: /root/.m2
- name: 'maven:3-jdk-8-slim'
  entrypoint: 'mvn'
  args: ['-P drools-5.5', '-DskipTests', '-Dmaven.compiler.source=1.7', '-Dmaven.compiler.target=1.7', 'install']
  dir: 'opencds/opencds-parent'
  volumes:
  - name: 'm2'
    path: /root/.m2
- name: 'maven:3-jdk-8-slim'
  entrypoint: 'mvn'
  args: ['-Dmaven.compiler.source=1.7', '-Dmaven.compiler.target=1.7', 'compile', 'assembly:single']
  dir: 'rules-packager'
  volumes:
  - name: 'm2'
    path: /root/.m2
- name: 'maven:3-jdk-8-slim'
  entrypoint: 'java'
  args: ['-jar', 'rules-packager/target/rules-packager-1.0.0-SNAPSHOT-jar-with-dependencies.jar', 'docker/ice-gen.properties', 'gov.nyc.cir^ICE^1.0.0', 'org.cdsframework^ICE^1.0.0']
  dir: '.'
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '--tag=gcr.io/$PROJECT_ID/ice-opencds:$BRANCH_NAME', '-f', 'docker/Dockerfile', '.']
  dir: '.'
images: ['gcr.io/$PROJECT_ID/ice-opencds']
timeout: 900s
